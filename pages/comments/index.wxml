<!--pages/comments/index.wxml-->
<view class="container">
  <!-- 原帖内容 -->
  <view class="post-card">
    <view class="post-header">
      <image class="avatar" src="/images/icons/default-avatar.png" mode="aspectFill" />
      <view class="post-info">
        <text class="nickname">{{post.nickname}}</text>
        <text class="time">{{post.publish_time}}</text>
      </view>
    </view>
    <view class="post-content">
      <text>{{post.content}}</text>
    </view>
    <view class="post-images" wx:if="{{post.images.length > 0}}">
      <image 
        wx:for="{{post.images}}" 
        wx:key="*this" 
        src="{{item}}" 
        mode="aspectFill" 
        bindtap="previewImage"
        data-current="{{item}}"
        data-urls="{{post.images}}"
      />
    </view>
  </view>

  <!-- 评论列表 -->
  <view class="comments-section">
    <view class="section-title">评论 ({{comments.length}})</view>
    <view class="comment-list" wx:if="{{comments.length > 0}}">
      <view class="comment-item" wx:for="{{comments}}" wx:key="recordId">
        <view class="comment-main">
          <image class="avatar" src="{{item.avatarUrl || '/images/icons/default-avatar.png'}}" mode="aspectFill" />
          <view class="comment-content">
            <view class="comment-header">
              <text class="nickname">{{item.nickname}}</text>
              <text class="time">{{item.publish_time}}</text>
            </view>
            <text class="text">{{item.content}}</text>
            <view class="comment-actions">
              <view class="action-item">
                <image class="action-icon" src="/images/icons/like.png" />
                <text class="action-count">{{item.like_count || 0}}</text>
              </view>
              <view class="action-item" bindtap="onReplyComment" data-id="{{item.recordId}}">
                <image class="action-icon" src="/images/icons/comment.png" />
                <text class="action-text">回复</text>
              </view>
            </view>
          </view>
        </view>
        <!-- 回复列表 -->
        <view class="reply-list" wx:if="{{item.replies && item.replies.length > 0}}">
          <view class="reply-item" wx:for="{{item.replies}}" wx:key="recordId" wx:for-item="reply">
            <image class="avatar-small" src="{{reply.avatarUrl || '/images/icons/default-avatar.png'}}" mode="aspectFill" />
            <view class="reply-content">
              <view class="reply-header">
                <text class="nickname">{{reply.nickname}}</text>
                <text class="time">{{reply.publish_time}}</text>
              </view>
              <text class="text">{{reply.content}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:else>
      <text>暂无评论</text>
    </view>
  </view>

  <!-- 评论输入框 -->
  <view class="comment-input">
    <input 
      class="input" 
      placeholder="{{replyTo ? '回复 ' + replyTo + '...' : '写评论...'}}"
      value="{{commentText}}"
      bindinput="onCommentInput"
      focus="{{!!replyTo}}"
    />
    <button 
      class="send-btn" 
      bindtap="onSendComment" 
      disabled="{{!commentText}}"
    >发送</button>
  </view>
</view>