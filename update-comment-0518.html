<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>评论互动 - 大事小事追踪</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="stylesheet" href="assets/comment.css">
    <link rel="stylesheet" href="assets/event-card.css">
    <link rel="stylesheet" href="assets/css/discussion-tree.css">
</head>
<body>
    <div class="navbar">
        <div class="navbar-back" onclick="window.location.href='event-detail.html'">
            <i class="fas fa-chevron-left"></i>
        </div>
        <div class="navbar-title">评论互动</div>
        <div class="navbar-action"></div>
    </div>
    
    <div class="content">
        <!-- 事件详情卡片 -->
        <div class="event-card fade-in">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="user-info flex items-center mb-3">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="头像" class="rounded-full mr-3" style="width:44px;height:44px;object-fit:cover;">
                        <div class="flex flex-col justify-center gap-1">
                            <div class="font-bold text-base leading-tight">王物业</div>
                            <span class="text-xs px-2 py-1 rounded bg-blue-100 text-blue-600 leading-tight">物业管理员</span>
                        </div>
                    </div>
                </div>
                <div class="d-flex align-items-center gap-2" style="height: 30px;">
                    <span class="status-ongoing">进行中</span>
                    <div class="event-menu">
                        <div class="event-menu-btn" onclick="toggleEventMenu()">
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                        <div class="event-menu-content" id="eventMenu">
                            <div class="menu-item" onclick="showStatusSelector()">
                                <i class="fas fa-exchange-alt"></i>
                                <span>修改状态</span>
                            </div>
                            <div class="menu-item danger" onclick="deleteTimeline()">
                                <i class="fas fa-trash"></i>
                                <span>删除</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <p class="event-content prose prose-sm max-w-none text-gray-800">
                <strong>物业公司查看安装电瓶车门禁系统位置</strong><br>
                详情请参考<a href="https://property.example.com/notice/123" target="_blank" class="text-blue-600 underline">《小区电瓶车管理规定》</a>进行了解。<br>
                现场勘查确定了电瓶车门禁系统的最佳安装位置，将于下周开始施工。
            </p>
            
            <div class="event-images">
                <div class="event-image" onclick="previewImage(this)">
                    <img src="https://picsum.photos/300/300?random=1" alt="活动图片">
                </div>
                <div class="event-image" onclick="previewImage(this)">
                    <img src="https://picsum.photos/300/300?random=2" alt="活动图片">
                </div>
                <div class="event-image" onclick="previewImage(this)">
                    <img src="https://picsum.photos/300/300?random=3" alt="活动图片">
                </div>
            </div>
            
            <div class="event-actions flex justify-between items-center text-sm text-gray-500 mt-2">
                <span>2024-03-20 14:00</span>
                <div class="flex items-center text-secondary">
                    <i class="far fa-comment mr-2"></i>
                    <span>32条评论</span>
                </div>
            </div>
        </div>
        
        <!-- 评论区域 -->
            <!-- 新的结构化讨论区 -->
            <div class="structured-discussion-area px-2 py-3 mb-4">  <!-- 外层容器移除了卡片样式，保留了内外边距 --> 
                <!-- 面包屑导航 -->
                <div class="breadcrumb-nav text-sm text-gray-500 mb-3 p-2 bg-gray-100 rounded-md">
                    <span>主议题</span> &gt; <span>物业改进建议</span> &gt; <span class="font-semibold text-gray-700">安装电瓶车门禁</span>
                </div>

                <!-- 结构化讨论树状图容器，直接可见 -->
                <div id="discussion-tree-container" class="mb-4 p-3 bg-white rounded-lg border border-gray-200 shadow-sm">
                    <p class="text-center text-gray-500 text-sm">讨论结构图将在此处显示...</p>
                </div>

                <!-- 操作栏：添加新论点按钮 -->
                <div class="flex justify-end items-center mb-4"> 
                    <button id="add-main-argument-button" class="bg-blue-500 hover:bg-blue-600 text-white text-sm py-2 px-3 rounded-md flex items-center transition-colors duration-150">
                        <i class="fas fa-plus mr-2"></i> 发表新论点
                    </button>
                </div>

                <!-- 论点列表容器 -->
                <div id="argument-list" class="space-y-3">
                    <!-- 示例论点卡片 - 将由JS动态生成和填充 --> 
                    
                     <!-- 论点 1: 支持 (Pro) --> 
                    <div class="argument-card bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-150">
                        <div class="flex items-start space-x-3">
                            <img src="https://randomuser.me/api/portraits/men/35.jpg" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-gray-100">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-sm text-gray-800">业主张三</span>
                                    <span class="text-xs text-gray-400">2小时前</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1 mb-2 leading-relaxed">我非常支持安装电瓶车门禁！能有效规范停车，减少乱停放现象，对小区的整体安全和美观都有好处。</p>
                                <div class="mb-2">
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-700 font-medium">支持</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 space-x-4">
                                    <button class="hover:text-green-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-up mr-1"></i> 25</button>
                                    <button class="hover:text-red-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-down mr-1"></i> 2</button>
                                    <button class="hover:text-blue-600 flex items-center transition-colors duration-150"><i class="fas fa-reply mr-1"></i> 查看回应 (3)</button>
                                </div>
                            </div>
                        </div>
                    </div>

                     <!-- 论点 2: 反对 (Con) --> 
                    <div class="argument-card bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-150">
                        <div class="flex items-start space-x-3">
                            <img src="https://randomuser.me/api/portraits/women/60.jpg" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-gray-100">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-sm text-gray-800">居民李女士</span>
                                    <span class="text-xs text-gray-400">1小时前</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1 mb-2 leading-relaxed">坚决反对！我家有两辆电瓶车，来客人了怎么办？高峰期会不会堵在门口？物业有考虑过这些实际问题吗？</p>
                                <div class="mb-2">
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-red-100 text-red-700 font-medium">反对</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 space-x-4">
                                    <button class="hover:text-green-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-up mr-1"></i> 5</button>
                                    <button class="hover:text-red-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-down mr-1"></i> 18</button>
                                    <button class="hover:text-blue-600 flex items-center transition-colors duration-150"><i class="fas fa-reply mr-1"></i> 查看回应 (5)</button>
                                </div>
                            </div>
                        </div>
                    </div>

                     <!-- 论点 3: 提问 (Question) --> 
                    <div class="argument-card bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-150">
                        <div class="flex items-start space-x-3">
                            <img src="https://randomuser.me/api/portraits/men/42.jpg" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-gray-100">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-sm text-gray-800">好奇的王大爷</span>
                                    <span class="text-xs text-gray-400">45分钟前</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1 mb-2 leading-relaxed">这个门禁系统具体是什么牌子的？识别率高不高？如果坏了维修响应快吗？费用是谁出？</p>
                                 <div class="mb-2">
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700 font-medium">提问</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 space-x-4">
                                    <button class="hover:text-green-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-up mr-1"></i> 10</button>
                                    <button class="hover:text-red-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-down mr-1"></i> 0</button>
                                    <button class="hover:text-blue-600 flex items-center transition-colors duration-150"><i class="fas fa-reply mr-1"></i> 查看回应 (2)</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                     <!-- 论点 4: 建议 (Suggestion/Proposal) - 模拟子论点/孙论点场景 (视觉上一致) --> 
                    <div class="argument-card bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-150">
                        <div class="flex items-start space-x-3">
                            <img src="https://randomuser.me/api/portraits/women/7.jpg" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-gray-100">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-sm text-gray-800">热心邻居周姐</span>
                                    <span class="text-xs text-gray-400">30分钟前</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1 mb-2 leading-relaxed">我建议在门禁旁边设置一个临时访客通道，并由保安手动登记，这样既能管理也能兼顾临时需求。另外，可以对多车家庭提供第二辆车半价的月卡优惠。</p>
                                 <div class="mb-2">
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-700 font-medium">建议</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 space-x-4">
                                    <button class="hover:text-green-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-up mr-1"></i> 22</button>
                                    <button class="hover:text-red-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-down mr-1"></i> 1</button>
                                    <button class="hover:text-blue-600 flex items-center transition-colors duration-150"><i class="fas fa-reply mr-1"></i> 添加回应</button> {/* <!-- 0 回应 --> */}
                                </div>
                            </div>
                        </div>
                    </div>

                     <!-- 论点 5: 澄清 (Clarification) - 可能是对某个问题的回复 --> 
                    <div class="argument-card bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-150">
                        <div class="flex items-start space-x-3">
                            <img src="https://randomuser.me/api/portraits/men/11.jpg" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-gray-100">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-sm text-gray-800">物业小陈</span>
                                    <span class="text-xs text-gray-400">20分钟前</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1 mb-2 leading-relaxed">针对王大爷的提问：我们选用的门禁系统是XX品牌，识别率99.5%，有24小时维保。首次安装费用由公共维修基金支出，后续维护从业委会划拨。</p>
                                 <div class="mb-2">
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-700 font-medium">澄清</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 space-x-4">
                                    <button class="hover:text-green-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-up mr-1"></i> 8</button>
                                    <button class="hover:text-red-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-down mr-1"></i> 0</button>
                                    <button class="hover:text-blue-600 flex items-center transition-colors duration-150"><i class="fas fa-reply mr-1"></i> 添加回应</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 论点 6: 补充信息 (Additional Info) --> 
                    <div class="argument-card bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-150">
                        <div class="flex items-start space-x-3">
                            <img src="https://randomuser.me/api/portraits/women/25.jpg" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-gray-100">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-sm text-gray-800">信息通小赵</span>
                                    <span class="text-xs text-gray-400">15分钟前</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1 mb-2 leading-relaxed">我查了一下，隔壁XX小区去年就装了类似的系统，据说效果还不错，初期有些小问题，后面都解决了。他们当时还公示了费用明细。</p>
                                 <div class="mb-2">
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 font-medium">补充信息</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 space-x-4">
                                    <button class="hover:text-green-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-up mr-1"></i> 12</button>
                                    <button class="hover:text-red-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-down mr-1"></i> 0</button>
                                    <button class="hover:text-blue-600 flex items-center transition-colors duration-150"><i class="fas fa-reply mr-1"></i> 查看回应 (1)</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 论点 7: 担忧 (Concern) --> 
                    <div class="argument-card bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-150">
                        <div class="flex items-start space-x-3">
                            <img src="https://randomuser.me/api/portraits/men/50.jpg" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-gray-100">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-sm text-gray-800">老刘师傅</span>
                                    <span class="text-xs text-gray-400">10分钟前</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1 mb-2 leading-relaxed">我担心这个门禁系统会不会影响消防车的进出？紧急情况下能保证快速开启吗？安全第一啊！</p>
                                 <div class="mb-2">
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-pink-100 text-pink-700 font-medium">担忧</span>
                                </div>
                                <div class="flex items-center text-xs text-gray-500 space-x-4">
                                    <button class="hover:text-green-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-up mr-1"></i> 30</button>
                                    <button class="hover:text-red-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-down mr-1"></i> 0</button>
                                    <button class="hover:text-blue-600 flex items-center transition-colors duration-150"><i class="fas fa-reply mr-1"></i> 查看回应 (4)</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 论点 8: 中立/观察 (Neutral/Observation) --> 
                    <div class="argument-card bg-white p-3 rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-150">
                        <div class="flex items-start space-x-3">
                            <img src="https://randomuser.me/api/portraits/women/33.jpg" alt="用户头像" class="w-10 h-10 rounded-full border-2 border-gray-100">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-sm text-gray-800">路过的观察员</span>
                                    <span class="text-xs text-gray-400">5分钟前</span>
                                </div>
                                <p class="text-sm text-gray-700 mt-1 mb-2 leading-relaxed">这个事情讨论得挺激烈。任何方案都有利有弊，关键看怎么权衡和后续管理。期待最终的方案能让大多数人满意。</p>
                                 <div class="mb-2">
                                    <span class="text-xs px-2 py-0.5 rounded-full bg-gray-200 text-gray-700 font-medium">中立/观察</span> {/* <!-- Adjusted neutral color --> */}
                                </div>
                                <div class="flex items-center text-xs text-gray-500 space-x-4">
                                    <button class="hover:text-green-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-up mr-1"></i> 3</button>
                                    <button class="hover:text-red-600 flex items-center transition-colors duration-150"><i class="fas fa-thumbs-down mr-1"></i> 0</button>
                                    <button class="hover:text-blue-600 flex items-center transition-colors duration-150"><i class="fas fa-reply mr-1"></i> 添加回应</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <!-- 结束：新的结构化讨论区 -->
    </div>
    
    <!-- 评论输入框 -->
    <div class="comment-input-container">
        <div class="comment-input-wrapper">
            <textarea class="comment-input" placeholder="说点什么..." id="comment-input" style="height: 40px; width: 226px;"></textarea>
        </div>
        <div class="image-upload" onclick="uploadImage()">
            <i class="far fa-image"></i>
        </div>
        <div class="send-btn" onclick="sendComment()">
            <i class="fas fa-paper-plane"></i>
        </div>
    </div>
    
    <!-- 删除确认弹窗 -->
    <div class="delete-modal">
        <div class="delete-modal-content">
            <div class="delete-modal-title">删除评论</div>
            <div class="delete-modal-message">确定要删除这条评论吗？此操作不可恢复。</div>
            <div class="delete-modal-actions">
                <div class="delete-modal-btn cancel" onclick="this.closest('.delete-modal').remove()">取消</div>
                <div class="delete-modal-btn confirm" onclick="deleteComment(this)">删除</div>
            </div>
        </div>
    </div>
    
    <!-- 状态选择器 -->
    <div class="status-selector" id="statusSelector">
        <div class="status-selector-header">
            <div class="status-selector-title">修改进展状态</div>
            <div class="status-selector-close" onclick="hideStatusSelector()">
                <i class="fas fa-times"></i>
            </div>
        </div>
        
        <div class="status-options-container">
            <div class="status-option" onclick="updateStatus('ongoing'); selectOption(this);">
                <div class="status-icon status-ongoing-icon">
                    <i class="fas fa-circle"></i>
                </div>
                <div class="status-text">
                    <div class="status-label">进行中</div>
                </div>
            </div>
            
            <div class="status-option" onclick="updateStatus('completed'); selectOption(this);">
                <div class="status-icon status-completed-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="status-text">
                    <div class="status-label">已结束</div>
                </div>
            </div>
        </div>
        
        <button class="status-cancel-btn" onclick="hideStatusSelector()">取消</button>
    </div>
    
    <!-- 删除进展确认弹窗 -->
    <div class="delete-progress-modal" id="deleteProgressModal">
        <div class="delete-progress-content">
            <div class="delete-progress-icon">
                <i class="fas fa-trash"></i>
            </div>
            <div class="delete-progress-title">删除进展</div>
            <div class="delete-progress-message">确定要删除这条进展吗？此操作不可恢复，删除后相关的评论也将一并删除。</div>
            <div class="delete-progress-actions">
                <div class="delete-progress-btn cancel" onclick="hideDeleteProgressModal()">取消</div>
                <div class="delete-progress-btn confirm" onclick="confirmDeleteProgress()">删除</div>
            </div>
        </div>
    </div>
    
    <script src="assets/js/structured-discussion.js" defer></script>
</body>
</html>